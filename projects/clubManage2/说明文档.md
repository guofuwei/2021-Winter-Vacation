# 项目说明

## 数据库说明

### 前言

```shell
数据库使用mysql8.0.26
```

### user_table

```sql
create table user_table(
	id int not null AUTO_INCREMENT,
    name  varchar(50) not null,
    faculty varchar(50) not null,
    classroom varchar(50) not null,
    studentid varchar(50) not null,
    password varchar(100) not null,
    identity varchar(50) not null,
    date timestamp not null DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);

insert into user_table(name,faculty,classroom,studentid,password,identity) VALUES('test','test','test','test','test','test');

update user_table set name=?,faculty=?,classroom=?,studentid=?,identity=? where id=3;
```



### activity_table

```sql
create table activity_table(
	id int not null AUTO_INCREMENT,
    name varchar(50) not null,
    type varchar(50) not null,
    initiator varchar(50) not null,
    thedescribe varchar(200) not null,
    starttime timestamp not null,
    endtime timestamp not null,
    place varchar(50) not null,
    maxnum varchar(20) not null,
   	state int not null DEFAULT 0,
    date timestamp not null DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);

# alter table activity_table modify name varchar(50) not null;

insert into activity_table(name,type,initiator,thedescribe,starttime,endtime,place,maxnum) values("test_name2","test_type2","test_initiator2","test_thedescribe2","20220101000001","20230101000001","test_place2","test_maxnum2");

update profiletable set type='test2',mydescribe='test2',income='test2',expend='test2',cash='test2',remark='test2' where id=1;
	
delete from profiletable where id=1;



```





## user_ref_act

```sql
create table user_ref_act(
	user_id int not null,
    act_id int not null
);

ALTER TABLE user_ref_act ADD CONSTRAINT FK_USER FOREIGN KEY(user_id) REFERENCES user_table(ID);
ALTER TABLE user_ref_act ADD CONSTRAINT FK_ACTIVITY FOREIGN KEY(act_id) REFERENCES activity_table(ID);
ALTER TABLE user_ref_act ADD CONSTRAINT PK_USER_REF_ACTIVITY PRIMARY KEY(user_id,act_id);

# 联合查询
select activity_table.* from  user_table,activity_table,user_ref_act where user_table.id = user_ref_act.user_id and activity_table.id = user_ref_act.act_id and user_table.id=4;

select * from activity_table where initiator="test_initiator";
```



## appeal_table

```sql
create table appeal_table(
    id int not null AUTO_INCREMENT,
    act_id int not null,
    act_name varchar(50) not null,
    act_type varchar(50) not null,
   	user_id int not null,
    user_name varchar(50) not null,
    date timestamp not null DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    reason varchar(300) not null,
    state varchar(20) not null default "",
    PRIMARY KEY (id)
);


    insert into appeal_table(act_id,act_name,act_type,user_id,user_name,reason) values(4,"退役军人宣讲","国防教育",5,"李四","对自己的思政得分有统计错误的怀疑");
```











## 错误码说明

| 错误码 | 说明               |
| :----- | ------------------ |
| 200    | 正常               |
| 10001  | 非法请求           |
| 10002  | 数据库错误         |
| 10003  | 生成加密密钥出错   |
| 10004  | 生成令牌出错       |
|        |                    |
|        |                    |
|        |                    |
|        |                    |
| 10011  | 该学号已被注册     |
| 10012  | 学号或密码错误     |
| 10013  | 修改密码旧密码错误 |
|        |                    |
|        |                    |
|        |                    |







```vue
<template>
  <div class="login">
    <section class="form_container">
      <div class="manage_tip">
        <span class="title">社团管理系统</span>
        <el-form
          :model="loginUser"
          :rules="rules"
          ref="loginForm"
          label-width="60px"
          class="loginForm"
        >
          <el-form-item label="学号" prop="studentid">
            <el-input
              v-model="loginUser.studentid"
              placeholder="请输入学号"
            ></el-input>
          </el-form-item>

          <el-form-item label="密码" prop="password">
            <el-input
              type="password"
              v-model="loginUser.password"
              placeholder="请输入密码"
            ></el-input>
          </el-form-item>

          <el-form-item>
            <el-button
              type="primary"
              class="submit_btn"
              @click="submitForm('loginForm')"
              >登录</el-button
            >
          </el-form-item>
          <div class="tiparea">
            <p>
              还没有账号？现在<router-link to="/register">注册</router-link>
            </p>
          </div>
        </el-form>
      </div>
    </section>
  </div>
</template>

<script>
import jwtDecode from "jwt-decode";
export default {
  name: "login",
  components: {},
  data() {
    return {
      loginUser: {
        studentid: "",
        password: "",
      },
      rules: {
        studentid: [
          {
            required: true,
            message: "学号不能为空",
            trigger: "blur",
          },
        ],
        password: [
          {
            required: true,
            message: "密码不能为空",
            trigger: "blur",
          },
          {
            min: 6,
            max: 30,
            message: "长度在6到30之间",
            trigger: "blur",
          },
        ],
      },
    };
  },
  methods: {
    submitForm(formName) {
      this.$refs[formName].validate((valid) => {
        if (valid) {
          this.$axios
            .post("/api/user/login", this.loginUser)
            .then((res) => {
              // 登录成功
              // 拿到token
              console.log(res);
              localStorage.setItem("eleToken", res.data.token);
              // 解析token
              const decoded = jwtDecode(res.data.token);
              console.log(decoded);
              this.$store.dispatch("setAuthenticated", !this.isEmpty(decoded));
              this.$store.dispatch("setUser", decoded);
            })
            .catch((err) => {
              console.error(err);
            });
          this.$router.push("/index");
        } else {
          console.log("error submit!!");
          return false;
        }
      });
    },
    isEmpty(value) {
      return (
        value === undefined ||
        value === null ||
        (typeof value === "object" && Object.keys(value).length === 0) ||
        (typeof value === "string" && value.trim().length === 0)
      );
    },
  },
};
</script>

<style scoped>
.login {
  position: relative;
  width: 100%;
  height: 100%;
  background: url(../assets/bg.jpg) no-repeat center center;
  background-size: 100% 100%;
}
.form_container {
  width: 370px;
  height: 210px;
  position: absolute;
  top: 20%;
  left: 34%;
  padding: 25px;
  border-radius: 5px;
  text-align: center;
}
.form_container .manage_tip .title {
  font-family: "Microsoft YaHei";
  font-weight: bold;
  font-size: 26px;
  color: #fff;
}
.loginForm {
  margin-top: 20px;
  background-color: #fff;
  padding: 20px 40px 20px 20px;
  border-radius: 5px;
  box-shadow: 0px 5px 10px #cccc;
}

.submit_btn {
  width: 100%;
}
.tiparea {
  text-align: right;
  font-size: 12px;
  color: #333;
}
.tiparea p a {
  color: #409eff;
}
</style>  
```

